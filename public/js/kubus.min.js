jQuery(document).ready(function(){$(window.applicationCache).bind("updateready",function(a){window.applicationCache.swapCache()})});
(function(a){a.BUILDER=a.BUILDER||{};var y=a.BUILDER;y.ConstructionArea=function(a,g,d){function f(){A.maxDistance=e/2*20;A.minDistance=e;A.reset()}function c(m){if(Math.round(m.point.z)<e&&Math.round(m.point.z)>0-e&&Math.round(m.point.x)<e&&Math.round(m.point.x)>0-e&&Math.round(m.point.y)<e/(l/2)*l){var a=new THREE.Mesh(G,t),b=m.face.normal.clone().multiplyScalar(l/2);a.position.copy(m.point).add(b);0!==e/(l/2)%2?(m=a.position.y,a.position.divideScalar(l).round().multiplyScalar(l),a.position.y=Math.abs(Math.floor(m/
l)*l+l/2)):a.position.divideScalar(l).floor().multiplyScalar(l).addScalar(l/2);0<a.position.y&&!h(a.position)&&(u.add(a),k.push(a),r=6,setTimeout(function(){C()},0))}}function h(m){for(var a=1;a<k.length;a++)if(m.equals(k[a].position))return!0;return!1}function q(){var m=new THREE.PerspectiveCamera(45,a.width()/a.height(),1,1E4);m.position.set(500,800,1300);m.lookAt(new THREE.Vector3);return m}function b(){var a=[],v=e/7,b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(e+v,0,e));b.vertices.push(new THREE.Vector3(e+
v,0,-e));var c=new THREE.LineBasicMaterial({color:39236,linewidth:2});a.push(new THREE.Line(b,c,THREE.LinePieces));b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(-(e+v),0,e));b.vertices.push(new THREE.Vector3(-(e+v),0,-e));c=new THREE.LineBasicMaterial({color:14842878,linewidth:2});a.push(new THREE.Line(b,c,THREE.LinePieces));b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(e,0,e+v));b.vertices.push(new THREE.Vector3(-e,0,e+v));c=new THREE.LineBasicMaterial({color:26807,linewidth:2});
a.push(new THREE.Line(b,c,THREE.LinePieces));b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(e,0,-(e+v)));b.vertices.push(new THREE.Vector3(-e,0,-(e+v)));c=new THREE.LineBasicMaterial({color:15964160,linewidth:2});a.push(new THREE.Line(b,c,THREE.LinePieces));return a}function n(){function a(m,b,c,n){var d=n.width()/n.height(),d=new THREE.OrthographicCamera(1200*d/2,1200*-d/2,600,-600);d.position.set(m,b,c);d.lookAt(new THREE.Vector3(0,e,0));m=N(n);return new y.View(m,d,n,u,e)}p=[];p.push(a(0,
1600,0,g[0]));p.push(a(0,e,e,g[1]));p.push(a(-e,e,0,g[2]));p.push(a(0,e,-e,g[3]));p.push(a(e,e,0,g[4]));g[5]&&p.push(a(0,1600,0,g[5]));p.forEach(function(a,m,b){a.init()})}function N(a,b){var c;c=b?Detector.webgl?new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}):new THREE.CanvasRenderer({alpha:!0}):new THREE.CanvasRenderer({alpha:!0});c.setClearColor(0,0);c.setPixelRatio(window.devicePixelRatio||1);c.setSize(a.width(),a.height());return c}function H(){var a=new THREE.Scene;
a.add(O);a.add(I);b().forEach(function(b,c,e){a.add(b)});return a}function P(a){a.object!=I&&(u.remove(a.object),k.splice(k.indexOf(a.object),1),r=6,setTimeout(function(){C()},0))}function Q(){requestAnimationFrame(Q);w.update();D.render(u,B)}function J(){for(var a=new THREE.Geometry,b=-e;b<=e;b+=l)a.vertices.push(new THREE.Vector3(-e,0,b)),a.vertices.push(new THREE.Vector3(e,0,b)),a.vertices.push(new THREE.Vector3(b,0,-e)),a.vertices.push(new THREE.Vector3(b,0,e));b=new THREE.LineBasicMaterial({color:0,
opacity:.2,transparent:!0});O=new THREE.Line(a,b,THREE.LinePieces);a=new THREE.PlaneBufferGeometry(2*e,2*e);a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));a=new THREE.Mesh(a);a.visible=!1;I=k[0]=a}function C(){var a=1==k.length?"0":k.length-1,b=$("#counter");b.length&&b.text(a)}function R(b){b.preventDefault();var e=b.pageX-a.offset().left,n=b.pageY-a.offset().top;if("mousedown"===b.type)E.x=e,E.y=n;else if("mouseup"===b.type&&E.x==e&&E.y==n&&(K.set(e/a.width()*2-1,2*-(n/a.height())+
1),L.setFromCamera(K,B),e=L.intersectObjects(k),0<e.length))switch(e=e[0],b.button){case 0:M?c(e):P(e);break;case 2:P(e)}}var l,e,k,G,u,B,D,t,L,E,K,O,I,A,p,M=!0,F=this,T=d||[],S={},x={},r=0,w;this.perspective=function(a){};this.clearCubes=function(){for(var a=1;a<k.length;a++)u.remove(k[a]);k.splice(1,k.length);C()};this.enableOrDisableOrbit=function(a){return"boolean"===typeof a?(A.enabled=a,!0):!1};this.loadModel=function(a){var b,c=t;a="object"===typeof a?a:JSON.parse(a);a=JSON.parse(LZString.decompressFromBase64(a.model));
k=[];e=l/2*a.baseSize;J();u=H();for(var d=0,g=a.cubes.length;d<g;d++)b="#"+a.cubes[d].color,F.setCubeMaterial(b),b=new THREE.Mesh(G,x[b]),b.position.x=a.cubes[d].x,b.position.y=a.cubes[d].y,b.position.z=a.cubes[d].z,u.add(b),k.push(b);C();n();F.renderPerspectives();t=c};this.renderPerspectives=function(){p.forEach(function(a,b,c){a.setSize();a.render()})};this.resize=function(){B.aspect=a.width()/a.height();B.updateProjectionMatrix();D.setSize(a.width(),a.height());F.renderPerspectives()};this.saveModel=
function(){function a(b,c,e,d){this.color=b;this.x=c;this.y=e;this.z=d}for(var b={baseSize:k[0].geometry.parameters.height/l,cubes:[],step:l/2},c=1;c<k.length;c++){var e=k[c].material.map.sourceFile,e=e.replace("public/img/textures/",""),e=e.replace(".png","");b.cubes.push(new a(e,k[c].position.x,k[c].position.y,k[c].position.z))}return LZString.compressToBase64(JSON.stringify(b))};this.setBaseSize=function(a){return!isNaN(a)&&1<=a&&10>=a?(e=l/2*a,k=[],J(),f(),u=H(),n(),C(),r=6,!0):!1};this.getBaseSize=
function(){return e/(l/2)};this.setCubeMaterial=function(a){return/^#([A-Fa-f0-9]{6})$/.test(a)?(Detector.webgl?void 0==x[a]?(t=new THREE.MeshBasicMaterial({map:S[a.toUpperCase()]||THREE.ImageUtils.loadTexture("public/img/textures/"+a.toUpperCase().substring(1)+".png")}),x[a]=t):t=x[a]:void 0==x[a]?(t=new THREE.MeshBasicMaterial({color:a}),x[a]=t):t=x[a],!0):!1};this.toggleBuildMode=function(){M=!M};this.shouldRenderPerspectives=function(a){p.forEach(function(b){b.shouldRender(a)});p[5].shouldRender(!0)};
(function(){if(!(a instanceof jQuery))throw Error();for(var b=0;b<g.length;b++)if(!(g[b]instanceof jQuery))throw Error();T.forEach(function(a){requestAnimationFrame(function(){THREE.ImageUtils.loadTexture("public/img/textures/"+a.toUpperCase().substring(1)+".png",void 0,function(b){S[a]=b})})});F.setCubeMaterial("#FBE430");jQuery.Event("updateView");l=50;k=[];p=[];G=new THREE.BoxGeometry(l,l,l);L=new THREE.Raycaster;E=new THREE.Vector2;K=new THREE.Vector2;e=250;J();u=H();B=q();D=N(a,!0);A=new THREE.OrbitControls(B,
D.domElement);A.noPan=!0;f();w=new Stats;w.setMode(1);w.domElement.style.position="absolute";w.domElement.style.left="0px";w.domElement.style.top="0px";w.domElement.style["z-index"]=1E3;document.body.appendChild(w.domElement);a.append(D.domElement);a[0].addEventListener("mousedown",R);a[0].addEventListener("mouseup",R);n();setTimeout(function(){Q()},1E3)})();setInterval(function(){requestAnimationFrame(function(){0<r&&p[0].render()&&r--})},400);setInterval(function(){requestAnimationFrame(function(){0<
r&&p[1].render()&&r--})},400);setInterval(function(){requestAnimationFrame(function(){0<r&&p[2].render()&&r--})},400);setInterval(function(){requestAnimationFrame(function(){0<r&&p[3].render()&&r--})},400);setInterval(function(){requestAnimationFrame(function(){0<r&&p[4].render()&&r--})},400);setInterval(function(){requestAnimationFrame(function(){0<r&&p[5].render()&&r--})},400)};y.View=function(a,g,d,f,c){var h=!0;this.render=function(){return h?(a.render(f,g),!0):!1};this.setSize=function(){var f=
2*c-10;"topView"==d.attr("id")?f=2*c+c/20:"preview"==d.attr("id")&&(f=2*c+c/2);var b=d.width()/d.height();a.setSize(d.width(),d.height());g.left=b*f/2;g.right=-b*f/2;g.top=f/2;g.bottom=-f/2;g.updateProjectionMatrix()};this.init=function(){d.empty();d.append(a.domElement)};this.shouldRender=function(a){h=a}}})(window);
(function(a){a.BUILDER=a.BUILDER||{};a.BUILDER.BuildingSaver=function(){function a(d,f){for(var c in f)if(c=c.trim().toLowerCase(),d=d.trim().toLowerCase(),c==d)return!0;return!1}function z(){return localStorage.getItem("buildings")?JSON.parse(localStorage.getItem("buildings")):!1}var g=this;this.getBuilding=function(a){var f=z();console.log("New");a=a.trim().toLowerCase();console.log(f);return f?f[a]:!1};this.saveBuildings=function(d){var f=z()||{},c;for(c in d)c=c.trim().toLowerCase(),a(c,f)||(f[c]=
d[c]);d={};c=0;for(var g in f){var q=new Date((new Date(f[g].date)).getTime()+2592E6),b=new Date;b.setHours(0,0,0,0);if(q>=b.getTime()){if(250<=c)break;d[g]=f[g];c+=1}}localStorage.setItem("buildings",JSON.stringify(d))};this.saveNewBuilding=function(d,f){d=d.trim().toLowerCase();if(a(d,z()))return!1;var c={};f=LZString.compressToBase64(f);var h=new Date,q=h.getDate();10>q&&(q="0"+q);var b=h.getMonth()+1;10>b&&(b="0"+b);h=h.getFullYear();c[d]={model:f,date:h+"-"+b+"-"+q};g.saveBuildings(c);return!0}}})(window);
jQuery(document).ready(function(a){function y(b){g();b.hasClass("chosen")||(a(".buildOption").removeClass("chosen"),b.toggleClass("chosen"),c.toggleBuildMode())}function z(b){var n=b.attr("href"),d=n!==h;g();if(d){if("#save"==n||"#import"==n)"#save"==n?a("#Submit").val("Spara"):a("#Submit").val("H\u00e4mta"),n="#FormModal";a("#modal").toggleClass("open");a(n).toggleClass("open");a("#alert").text("");a(".modalOption").toggleClass("faded");b.removeClass("faded");h=n;c.enableOrDisableOrbit(!1)}}function g(){a(h).removeClass("open");
a("#modal").removeClass("open");a(".modalOption").removeClass("faded");a("#Name").val("");h=null;c.enableOrDisableOrbit(!0)}var d=[a("#topView"),a("#blueView"),a("#redView"),a("#yellowView"),a("#greenView"),a("#preview")],f=[];null!==a("#alert").text()&&a("#alert").toggleClass("sadSmiley");a("#colorsModal a").each(function(b,c){"#random"!=a(c).attr("href")&&f.push(a(c).attr("href"))});var c=new BUILDER.ConstructionArea(a("#ThreeJScontainer"),d,f);c.renderPerspectives();var h=null,q;document.querySelector("#ThreeJScontainer").addEventListener("mousedown",
function(){"#random"==q&&c.setCubeMaterial(f[Math.floor(Math.random()*(f.length-1))])});a("#toggleCounter").on("click",function(b){b.preventDefault();">"===a("#toggleArrow").text()?(a("#toggleArrow").text("<"),a(".counter").show()):"<"===a("#toggleArrow").text()&&(a("#toggleArrow").text(">"),a(".counter").hide())});a("#menu").on("click","a",function(b){b.preventDefault();a(this).hasClass("buildOption")?y(a(this)):(z(a(this)),c.renderPerspectives())});a("#perspectives").on("click","a",function(a){a.preventDefault()});
a("#togglePerspective").on("click",function(b){b.preventDefault();b=a("#togglePerspective");var d=a("#perspectives");b.hasClass("open")?(d.hide(),c.shouldRenderPerspectives(!1),b.attr("class","close"),b.text("<")):(d.show(),c.shouldRenderPerspectives(!0),b.attr("class","open"),b.text(">"))});a("#modal").click(function(a){"DIV"==a.target.tagName&&g()});a("#modal").on("click","a",function(b){b.preventDefault();if(a(this).hasClass("color"))b=a(this).attr("href"),void 0!=q&&a("#cube").removeClass("color-"+
q.substring(1)),q=b,a("#cube").addClass("color-"+q.substring(1)),"#random"==b&&(b=f[Math.floor(Math.random()*(f.length-1))]),c.setCubeMaterial(b),y(a("#cube")),g();else if(a(this).hasClass("sizeControl"))a:{b=a(this).attr("href");var d=c.getBaseSize();switch(b){case "#up":if(10>d)d=parseInt(d)+1;else break a;break;case "#down":if(1<d)d=parseInt(d)-1;else break a}a("#sizePreview").text(d);c.setBaseSize(d);c.renderPerspectives();a("#ThreeJScontainer").trigger("updateView")}else a(this).hasClass("perspective")?
setPerspective(a(this)):("#import"!=a(this).attr("href")&&"#save"!=a(this).attr("href")||z(a(this)),"#print"==a(this).attr("href")&&(g(),window.print()),"#reset"==a(this).attr("href")&&(c.clearCubes(),c.renderPerspectives(),a("#ThreeJScontainer").trigger("updateView"),g()))});navigator.onLine&&a("#formOfflineInfo").hide();a(window).on("online",function(b){a("#formOfflineInfo").hide()});a(window).on("offline",function(b){a("#formOfflineInfo").show()});a("#Submit").on("click",function(b){b.preventDefault();
var d=a.trim(a("#Name").val()),f=new BUILDER.BuildingSaver,h=a("#alert");if(""==d||null==d||void 0==d)h.text("Namnet \u00e4r f\u00f6r kort");else if(50>=d.length)if("H\u00e4mta"==a(this).val())navigator.onLine?a.ajax({type:"GET",url:"api/"+d,statusCode:{200:function(a){c.loadModel(a.data);g()},400:function(a){(a=f.getBuilding(d))?(c.loadModel(a),g()):(console.log("Could not find that building."),h.text("Byggnaden hittades inte"))}}}):(b=f.getBuilding(d))?(c.loadModel(b),g()):h.text("Byggnaden hittades inte");
else{b="api/create";var q=LZString.decompressFromBase64(c.saveModel());navigator.onLine?a.ajax({type:"POST",url:b,data:{name:d,model:q},statusCode:{201:function(a){f.saveBuildings(JSON.parse(a.data));g()},400:function(a){h.text("Namnet finns redan")},503:function(a){h.text("Ett fel intr\u00e4ffade, f\u00f6rs\u00f6k igen")}}}):f.saveNewBuilding(d,q)?g():h.text("Namnet finns redan")}else h.text("Namnet \u00e4r f\u00f6r l\u00e5ngt");return!1});a(window).resize(function(a){c.resize()})});